name: Auto-label Documentation Update Issues

on:
  issues:
    types:
      - opened

jobs:
  add-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Extract issue body
        id: extract_body
        uses: actions/github-script@v7
        with:
          script: |
            const issueBody = context.payload.issue.body;
            return issueBody;

      - name: Determine labels
        id: determine_labels
        run: |
          LABELS=""
          FLAT_ISSUE_BODY=$(echo "${{ steps.extract_body.outputs.result }}" | tr '\n' ' ')
          for label in "Alloy" "Blueprint" "Caster" "CITE" "Gallery" "Gameboard" "Player" "Steamfitter" "TopoMojo" "General Docs Update" "New feature" "Correction" "Enhancement" "Other"; do
            if echo "$FLAT_ISSUE_BODY" | grep -q "- \[x\] $label"; then
              LABELS="$LABELS $label"
            fi
          done
          echo "LABELS=$(echo $LABELS | xargs)" >> $GITHUB_ENV
      - name: Add labels to issue
        uses: actions/github-script@v7
        with:
          script: |
            const labels = process.env.LABELS.split(' ');
            github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: labels
            });
